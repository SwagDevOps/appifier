app: GitKraken

ingredients:
  dist: trusty
  sources:
    - deb http://archive.ubuntu.com/ubuntu/ trusty main universe
  script:
    - set -eux
    # variables ------------------------------------------------------
    - PACKAGE_URL=https://release.axocdn.com/linux/gitkraken-amd64.deb
    - FILE=`basename -- "${PACKAGE_URL}"`
    # cleanup --------------------------------------------------------
    - rm -rfv *.gz VERSION *.png *.svg *.deb *.sh tmp/
    # download -------------------------------------------------------
    - wget -c "${PACKAGE_URL}" -O "${FILE}"
    # version --------------------------------------------------------
    - dpkg -I "${FILE}" | grep -E '^\s*Version:\s+' | awk '{print $2}' > VERSION

script:
  - set -eux
  # files ------------------------------------------------------------
  - rm -fv *.png *.svg usr/bin/gitkraken
  - ln usr/share/gitkraken/gitkraken.png .
  - ln -sfvr usr/share/gitkraken/gitkraken usr/bin/
  - chmod +x usr/bin/gitkraken
  # desktop ----------------------------------------------------------
  - cat > gitkraken.desktop << EOF
  - [Desktop Entry]
  - Type=Application
  - Name=GitKraken
  - Icon=gitkraken
  - Exec=gitkraken %U
  - Categories=Development;IDE;
  - Comment=The downright luxurious Git client
  - StartupNotify=false
  - StartupWMClass=gitkraken
  - EOF

integration:
  name: GitKraken
  executable: gitkraken
  desktop:
    name: gitkraken
    override:
      'Desktop Entry':
        Exec: '{{executable.path}} %U'
        Icon: '{{icon.path}}'
