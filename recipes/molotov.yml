app: Molotov

ingredients:
  script:
    - set -eux
    # cleanup --------------------------------------------------------
    - rm -rf *.gz *.png *.sh VERSION *.part squashfs-root/
    # script file -----------------------------------------------------
    - SCRIPT=./ingredients.sh
    - cat > "${SCRIPT}" << EOF
    - set -eux
    # variables ------------------------------------------------------
    - SHORTNAME=molotov
    - VERSION_URL='https://desktop-auto-upgrade.molotov.tv/linux/manifest.json'
    - VERSION=\$(curl -L "\${VERSION_URL}" | jq -r '.version' | sed 's/^v//')
    - DOWNLOAD_URL="http://desktop-auto-upgrade.molotov.tv/linux/\${VERSION}/\${SHORTNAME}.AppImage"
    - FILE=\$(head -10 /dev/urandom | tr -cd '[:alnum:]' | cut -c -32).part
    # ensure version -------------------------------------------------
    - test -n "\${VERSION}"
    # output files ---------------------------------------------------
    - echo "\${VERSION}" > VERSION
    - wget --trust-server-names "\${DOWNLOAD_URL}" -O "\${FILE}"
    - chmod +x "\${FILE}"
    - ./"\${FILE}" --appimage-extract
    # ensure extracted directory -------------------------------------
    - test -d squashfs-root
    - EOF
    - /usr/bin/env sh "${SCRIPT}"

script:
  - set -eux
  - rm -rf ./*/
  - mv -v ../squashfs-root/* .
  - rm -fv molotov.png
  - cp usr/share/icons/hicolor/1024x1024/apps/molotov.png molotov.png

integration:
  name: Molotov
  executable: molotov
  desktop:
    name: molotov
    override:
      'Desktop Entry':
        Exec: '{{executable.path}} %u'
        Icon: '{{icon.path}}'
