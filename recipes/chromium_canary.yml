# @see https://build.opensuse.org/package/view_file/openSUSE:Leap:15.0/chromium/chromium-browser.desktop
# @see https://github.com/scheib/chromium-latest-linux/blob/4f4e9b85ea02a109e071452de936389cc2fd7376/update.sh

app: Chromium_Canary
lowerapp: chromium-browser
arch: x86_64

ingredients:
  packages:
    - chromium-browser
  script:
    - set -eu
    # variables ------------------------------------------------------
    - LOWERAPP=chromium-browser
    - REVISION=$(curl -sS 'https://www.googleapis.com/download/storage/v1/b/chromium-browser-snapshots/o/Linux_x64%2FLAST_CHANGE?alt=media')
    - DLD="https://www.googleapis.com/download/storage/v1/b/chromium-browser-snapshots/o/Linux_x64%2F${REVISION}%2Fchrome-linux.zip?alt=media"
    # output files ---------------------------------------------------
    - echo "${REVISION}" > VERSION
    - rm -f *.zip
    - rm -rf chrome-linux/
    - curl "$DLD" -o "chromium-${REVISION}.zip"
    - unzip -oq "chromium-${REVISION}.zip"
    - rm -f *.zip
    - cp -fp chrome-linux/product_logo_48.png "${LOWERAPP}.png"

script:
  - set -eu
  - LOWERAPP=chromium-browser
  - cp "../${LOWERAPP}.png" .
  - cat > "${LOWERAPP}.desktop" << EOF
  - [Desktop Entry]
  - Version=1.0
  - Name=Chromium Canary
  - Comment=Browse the World Wide Web
  - GenericName=Web Browser
  - Exec=chromium-browser %u
  - Terminal=false
  - X-MultipleArgs=false
  - Type=Application
  - Icon=chromium-browser
  - Categories=Network;WebBrowser;
  - MimeType=text/html;text/xml;application/xhtml+xml;x-scheme-handler/http;x-scheme-handler/https;
  - EOF
  - mkdir -p usr/share/applications
  - cp "${LOWERAPP}.desktop" usr/share/applications
  - cp -rfv ../chrome-linux usr/share/chrome-linux/
  - (cd usr && ln -sfvr share/chrome-linux/chrome bin/chromium-browser)